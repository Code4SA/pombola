dist: trusty

notifications:
  email: false

services:
  - docker

script:
  - "docker-compose up -d db elasticsearch"
  - "docker-compose run app bin/wait-for-deps.sh coverage run -a --source=pombola,pombola_sayit,wordcloud,za_hansard,writeinpublic ./manage.py test --settings=pombola.settings.tests_south_africa"

after_script:
  # Log DB output in case issues occurred where this can help us debug quicly
  - "docker-compose logs db elasticsearch"

  # Upload code coverage data to codecov.io
  - "docker-compose run --rm `bash <(curl -s https://codecov.io/env)` web codecov"
